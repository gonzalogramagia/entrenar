# Plan Técnico - Entrenar App

## Arquitectura General

### Frontend
- **Framework**: React + TypeScript + Vite
- **Testing**: Vitest + React Testing Library
- **UI**: Material UI (MUI)
- **Formularios**: React Hook Form + Zod
- **Estado**: React Context API

### Backend
- **Lenguaje**: Go
- **Framework**: Gorilla Mux
- **Base de datos**: Supabase (PostgreSQL)
- **Testing**: Go testing library

### Base de Datos
- **Proveedor**: Supabase
- **Motor**: PostgreSQL
- **Seguridad**: Row Level Security (RLS)

## Esquema de Base de Datos

### Tabla `workouts`
```sql
CREATE TABLE public.workouts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    exercise_id BIGINT REFERENCES public.exercises(id) ON DELETE CASCADE,
    weight DECIMAL(5,2) NOT NULL,
    reps INTEGER NOT NULL,
    serie INTEGER,
    seconds INTEGER,
    observations TEXT,
    exercise_session_id UUID DEFAULT gen_random_uuid(),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT workouts_pkey PRIMARY KEY (id),
    CONSTRAINT weight_positive CHECK (weight > 0),
    CONSTRAINT reps_positive CHECK (reps > 0),
    CONSTRAINT serie_positive CHECK (serie > 0),
    CONSTRAINT seconds_positive CHECK (seconds > 0)
);
```

**Campos actuales:**
- `exercise_session_id`: UUID para agrupar series del mismo ejercicio

**Índices para optimización:**
```sql
CREATE INDEX idx_workouts_created_at ON public.workouts(created_at);
CREATE INDEX idx_workouts_exercise_session_id ON public.workouts(exercise_session_id);
CREATE INDEX idx_workouts_user_id_created_at ON public.workouts(user_id, created_at);
```

### Tabla `workout_sessions` (Nueva)
```sql
CREATE TABLE public.workout_sessions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    session_date DATE NOT NULL,
    session_name TEXT DEFAULT 'Rutina de Fullbody',
    total_exercises INTEGER DEFAULT 0,
    effort INTEGER DEFAULT 0 CHECK (effort >= 0 AND effort <= 3),
    mood INTEGER DEFAULT 0 CHECK (mood >= 0 AND mood <= 3),
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    CONSTRAINT workout_sessions_pkey PRIMARY KEY (id)
);
```

**Campos principales:**
- `effort`: Nivel de esfuerzo (0-3 estrellas, amarillo)
- `mood`: Estado de ánimo (0-3 estrellas, naranja)
- `session_date`: Fecha de la sesión de entrenamiento
- `total_exercises`: Conteo automático de ejercicios

**Índices para optimización:**
```sql
CREATE INDEX idx_workout_sessions_user_id ON public.workout_sessions(user_id);
CREATE INDEX idx_workout_sessions_date ON public.workout_sessions(session_date);
CREATE INDEX idx_workout_sessions_user_date ON public.workout_sessions(user_id, session_date);
```

### Tabla `exercises`
```sql
CREATE TABLE public.exercises (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name TEXT NOT NULL,
    muscle_group_primary public.muscle_groups_role NOT NULL,
    muscle_group_secondary public.muscle_groups_role,
    equipment_id BIGINT REFERENCES public.equipment(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT exercises_pkey PRIMARY KEY (id),
    CONSTRAINT exercises_name_key UNIQUE (name)
);
```

### Tabla `equipment`
```sql
CREATE TABLE public.equipment (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name TEXT NOT NULL,
    category public.equipment_category NOT NULL,
    observations TEXT,
    image_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT equipment_pkey PRIMARY KEY (id),
    CONSTRAINT equipment_name_key UNIQUE (name)
);
```

### Enums Personalizados

#### `equipment_category`
```sql
CREATE TYPE public.equipment_category AS ENUM (
    'pesas_libres',
    'maquinas',
    'cables',
    'rack',
    'cardio',
    'accesorios'
);
```

#### `muscle_groups_role`
```sql
CREATE TYPE public.muscle_groups_role AS ENUM (
    'pecho',
    'espalda',
    'hombros',
    'biceps',
    'triceps',
    'piernas',
    'gluteos',
    'abdominales',
    'antebrazos',
    'pantorrillas'
);
```

#### `muscle_groups_category`
```sql
CREATE TYPE public.muscle_groups_category AS ENUM (
    'empuje',
    'tirar',
    'piernas',
    'core'
);
```

#### `wellness_metric_type`
```sql
CREATE TYPE public.wellness_metric_type AS ENUM (
    'effort',
    'mood',
    'energy',
    'sleep_quality'
);
```

## Funcionalidades Implementadas

### Frontend - Componentes Principales

#### 1. WorkoutHistory
- **Filtro por fecha** con DatePicker
- **Agrupamiento por día** con expandir/colapsar
- **Ratings de esfuerzo y ánimo** (3 estrellas, colores diferentes)
- **Modal detallado** para series de ejercicios
- **Funcionalidad de borrado** de series individuales
- **Diseño responsive** optimizado para móvil

#### 2. ExerciseList
- **Filtros avanzados** por grupo muscular y equipamiento
- **Modal informativo** para detalles de ejercicios
- **Diseño de cards** con información resumida
- **Búsqueda por texto** en tiempo real

#### 3. EquipmentList
- **Filtros por categoría** y búsqueda
- **Modal con imagen** y detalles completos
- **Diseño consistente** con otros componentes

#### 4. WorkoutForm
- **Integración con TimerComponent**
- **Validación con Zod**
- **Campos numéricos** optimizados para móvil
- **Selección de ejercicios** con autocompletado

### Backend - API Endpoints (Pendiente)

#### Workouts
```
GET    /api/workouts
POST   /api/workouts
PUT    /api/workouts/{id}
DELETE /api/workouts/{id}
```

#### Exercises
```
GET    /api/exercises
GET    /api/exercises/{id}
```

#### Equipment
```
GET    /api/equipment
GET    /api/equipment/{id}
```

## Metodología de Desarrollo

### Test-Driven Development (TDD)
- **Frontend**: Tests unitarios con Vitest + React Testing Library
- **Backend**: Tests unitarios con Go testing library
- **Ciclo**: Red → Green → Refactor

### Estructura de Proyecto
```
gym/
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── workout/
│   │   │   ├── exercises/
│   │   │   ├── equipment/
│   │   │   └── navigation/
│   │   ├── contexts/
│   │   └── types/
│   ├── tests/
│   └── package.json
├── backend/
│   ├── handlers/
│   ├── middleware/
│   ├── models/
│   └── tests/
└── docs/
    ├── plan-tecnico.md
    └── especificaciones.md
```

## Próximos Pasos

### 1. Backend Implementation
- [ ] Implementar handlers de Go
- [ ] Configurar middleware de autenticación
- [ ] Conectar con Supabase
- [ ] Implementar tests unitarios

### 2. Integración Frontend-Backend
- [ ] Configurar cliente HTTP
- [ ] Implementar servicios de API
- [ ] Manejo de errores
- [ ] Tests de integración

### 3. Deployment
- [ ] Configurar CI/CD con GitHub Actions
- [ ] Deploy en Vercel/Netlify (Frontend)
- [ ] Deploy en Railway/Render (Backend)
- [ ] Configurar variables de entorno

### 4. Funcionalidades Adicionales
- [ ] Exportar datos a PDF/Excel
- [ ] Gráficos de progreso
- [ ] Notificaciones push
- [ ] Modo offline

## Notas Técnicas

### Optimizaciones de Base de Datos
- **Índices estratégicos** para consultas frecuentes
- **Constraints de integridad** para validación
- **Row Level Security** para seguridad por usuario
- **Enums personalizados** para consistencia de datos

### Consideraciones de UX
- **Diseño mobile-first** con responsive design
- **Animaciones suaves** para mejor feedback
- **Accesibilidad** con ARIA labels
- **Performance** con lazy loading y memoización

---

*Documento actualizado con los cambios recientes en la tabla `workouts` y las nuevas funcionalidades implementadas.*


